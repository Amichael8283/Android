// Общее число коммитов
static def generateVersionCode() {
    def result = "git rev-list HEAD --count".execute().text.trim() // Unix
    if (result.empty) result = "PowerShell -Command git rev-list HEAD --count".execute().text.trim() // Windows
    if (result.empty) throw new RuntimeException("Could not generate versioncode on this platform? Cmd output: ${result.text}")
    return result.toInteger()
}

ext.getVersionCode = { ->
    def result = "git rev-list HEAD --count".execute().text.trim() // Unix
    if (result.empty) result = "PowerShell -Command git rev-list HEAD --count".execute().text.trim() // Windows
    if (result.empty) throw new RuntimeException("Could not generate versioncode on this platform? Cmd output: ${result.text}")
    return result.toInteger()
}

gradle.allprojects {
    ext.verCode = {
        def result = "git rev-list HEAD --count".execute().text.trim() // Unix
        if (result.empty) result = "PowerShell -Command git rev-list HEAD --count".execute().text.trim() // Windows
        if (result.empty) throw new RuntimeException("Could not generate versioncode on this platform? Cmd output: ${result.text}")
        return result.toInteger()
    }
}